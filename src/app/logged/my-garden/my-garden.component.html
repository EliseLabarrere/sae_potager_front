<app-heading [activeBack]="false" title="Mon potager"></app-heading>
<div class="px-8 mt-[6.875rem] pb-36">
  <div class="section">
    <h4>Missions du jour</h4>
    <div *ngIf="haveToWatering && this.wateringPlants.length != 0" class="p-6 bg-success rounded-md">
      <div class="grid grid-cols-3 gap-4">
        <a
          [routerLink]="'/list-plants/' + [plant.id]"
          *ngFor="let plant of wateringPlants"
          class="bg-white flex flex-col items-center justify-center rounded-md h-24"
        >
          <app-plant-thumbnail [plant]="plant"></app-plant-thumbnail>
        </a>
      </div>
      <button
        class="btn btn-large bg-[#125944] text-white w-full mt-6 border-0"
        (click)="doDailyTasks()"
      >
        J'ai arrosé mes plantes
      </button>
    </div>
    <div
      *ngIf="!haveToWatering && this.wateringPlants.length != 0"
      class="p-6 bg-success text-white rounded-md flex flex-row"
    >
      <img
        class="w-20 mr-6"
        src="../../../assets/mascotte-heureuse.png"
        alt="Mascotte heureuse"
      />
      <div>
        <h5>Félicitation,</h5>
        <p>Tu as pensé à arroser toutes tes plantes !</p>
      </div>
    </div>
    <div
      *ngIf="this.wateringPlants.length == 0"
      class="p-6 bg-success text-white rounded-md flex flex-row"
    >
      <img
        class="w-20 mr-6"
        src="../../../assets/mascotte-triste.png"
        alt="Mascotte heureuse"
      />
      <div>
        <h5>Oh non,</h5>
        <p>Tu n'as pas de plantes à arroser aujour'hui !</p>
      </div>
    </div>
  </div>

  <div
    class="section"
    *ngIf="thereIsPlantsThisMonth || thereIsPlantsNextMonths"
  >
    <h4>Mes récoltes</h4>
    <div class="flex flex-col bg-primary text-white p-6 rounded-md gap-6">
      <div *ngIf="thereIsPlantsThisMonth">
        <h5>Période de récolte en cours</h5>
        <div class="grid grid-cols-2 gap-4">
          <div
            *ngFor="let plant of plantsThisMonth"
            class="flex flex-row items-center gap-2"
          >
            <a
              [routerLink]="[plant.id]"
              class="bg-white flex flex-col items-center justify-center rounded-full h-12 w-12"
            >
              <div
                *ngIf="plant"
                class="flex flex-col items-center justify-center"
              >
                <div *ngIf="!plant.img">
                  <svg
                    width="36"
                    height="36"
                    viewBox="0 0 36 36"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <mask
                      id="mask0_133_390"
                      style="mask-type: alpha"
                      maskUnits="userSpaceOnUse"
                      x="0"
                      y="0"
                      width="36"
                      height="36"
                    >
                      <rect
                        x="0.0768127"
                        y="0.72197"
                        width="35"
                        height="35"
                        fill="#D9D9D9"
                      />
                    </mask>
                    <g mask="url(#mask0_133_390)">
                      <path
                        d="M17.5768 31.347C14.7331 31.347 12.3207 30.3565 10.3398 28.3756C8.35892 26.3947 7.36847 23.9824 7.36847 21.1386C7.36847 18.8539 8.04295 16.8062 9.39191 14.9954C10.7409 13.1846 12.5091 11.9633 14.6966 11.3313C14.2105 11.2098 13.7365 11.0336 13.2747 10.8027C12.8129 10.5718 12.3997 10.274 12.0351 9.90947C11.2331 9.10738 10.7166 8.15339 10.4857 7.04749C10.2548 5.94158 10.2001 4.81745 10.3216 3.67509C11.464 3.55356 12.5881 3.60825 13.694 3.83915C14.7999 4.07006 15.7539 4.58655 16.556 5.38863C17.115 5.94766 17.5221 6.57961 17.7773 7.28447C18.0325 7.98933 18.1966 8.73065 18.2695 9.50843C18.5855 8.75495 18.9683 8.04402 19.4179 7.37561C19.8676 6.70721 20.3719 6.09349 20.931 5.53447C21.1983 5.26711 21.5386 5.13342 21.9518 5.13342C22.365 5.13342 22.7053 5.26711 22.9726 5.53447C23.24 5.80183 23.3737 6.14211 23.3737 6.5553C23.3737 6.96849 23.24 7.30877 22.9726 7.57613C22.4379 8.11086 21.964 8.70027 21.5508 9.34436C21.1376 9.98846 20.8337 10.6751 20.6393 11.4043C22.7782 12.0848 24.5039 13.3183 25.8164 15.1048C27.1289 16.8912 27.7851 18.9025 27.7851 21.1386C27.7851 23.9824 26.7947 26.3947 24.8138 28.3756C22.8329 30.3565 20.4206 31.347 17.5768 31.347ZM17.5768 28.4303C19.5942 28.4303 21.3138 27.7194 22.7357 26.2975C24.1575 24.8756 24.8685 23.156 24.8685 21.1386C24.8685 19.1213 24.1575 17.4017 22.7357 15.9798C21.3138 14.5579 19.5942 13.847 17.5768 13.847C15.5594 13.847 13.8398 14.5579 12.4179 15.9798C10.9961 17.4017 10.2851 19.1213 10.2851 21.1386C10.2851 23.156 10.9961 24.8756 12.4179 26.2975C13.8398 27.7194 15.5594 28.4303 17.5768 28.4303Z"
                        fill="#2A836B"
                      />
                    </g>
                  </svg>
                </div>
                <div *ngIf="plant.img">
                  <img
                    class="w-11"
                    alt="plant"
                    [src]="'../../../assets/' + plant.img"
                  />
                </div>
              </div>
            </a>
            <div>
              <p class="font-semibold">{{ plant.name }}</p>
              <button
                class="bg-[#212e50] text-white py-0.5 px-2 rounded-sm text-sm"
                (click)="harvestModel(plant)"
              >
                Récolter
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="thereIsPlantsNextMonths">
        <h5>Période de récolte à venir</h5>
        <div class="flex flex-col gap-4">
          <div
            *ngFor="
              let plant of showAllPlantsHarvest
                ? plantsNextMonths
                : plantsNextMonths.slice(0, 2)
            "
            class="flex flex-row items-center gap-2"
          >
            <a
              [routerLink]="'/list-plants/' + [plant.id]"
              class="bg-white flex flex-col items-center justify-center rounded-full h-12 w-12"
            >
              <div
                *ngIf="plant"
                class="flex flex-col items-center justify-center"
              >
                <div *ngIf="!plant.img">
                  <svg
                    width="36"
                    height="36"
                    viewBox="0 0 36 36"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <mask
                      id="mask0_133_390"
                      style="mask-type: alpha"
                      maskUnits="userSpaceOnUse"
                      x="0"
                      y="0"
                      width="36"
                      height="36"
                    >
                      <rect
                        x="0.0768127"
                        y="0.72197"
                        width="35"
                        height="35"
                        fill="#D9D9D9"
                      />
                    </mask>
                    <g mask="url(#mask0_133_390)">
                      <path
                        d="M17.5768 31.347C14.7331 31.347 12.3207 30.3565 10.3398 28.3756C8.35892 26.3947 7.36847 23.9824 7.36847 21.1386C7.36847 18.8539 8.04295 16.8062 9.39191 14.9954C10.7409 13.1846 12.5091 11.9633 14.6966 11.3313C14.2105 11.2098 13.7365 11.0336 13.2747 10.8027C12.8129 10.5718 12.3997 10.274 12.0351 9.90947C11.2331 9.10738 10.7166 8.15339 10.4857 7.04749C10.2548 5.94158 10.2001 4.81745 10.3216 3.67509C11.464 3.55356 12.5881 3.60825 13.694 3.83915C14.7999 4.07006 15.7539 4.58655 16.556 5.38863C17.115 5.94766 17.5221 6.57961 17.7773 7.28447C18.0325 7.98933 18.1966 8.73065 18.2695 9.50843C18.5855 8.75495 18.9683 8.04402 19.4179 7.37561C19.8676 6.70721 20.3719 6.09349 20.931 5.53447C21.1983 5.26711 21.5386 5.13342 21.9518 5.13342C22.365 5.13342 22.7053 5.26711 22.9726 5.53447C23.24 5.80183 23.3737 6.14211 23.3737 6.5553C23.3737 6.96849 23.24 7.30877 22.9726 7.57613C22.4379 8.11086 21.964 8.70027 21.5508 9.34436C21.1376 9.98846 20.8337 10.6751 20.6393 11.4043C22.7782 12.0848 24.5039 13.3183 25.8164 15.1048C27.1289 16.8912 27.7851 18.9025 27.7851 21.1386C27.7851 23.9824 26.7947 26.3947 24.8138 28.3756C22.8329 30.3565 20.4206 31.347 17.5768 31.347ZM17.5768 28.4303C19.5942 28.4303 21.3138 27.7194 22.7357 26.2975C24.1575 24.8756 24.8685 23.156 24.8685 21.1386C24.8685 19.1213 24.1575 17.4017 22.7357 15.9798C21.3138 14.5579 19.5942 13.847 17.5768 13.847C15.5594 13.847 13.8398 14.5579 12.4179 15.9798C10.9961 17.4017 10.2851 19.1213 10.2851 21.1386C10.2851 23.156 10.9961 24.8756 12.4179 26.2975C13.8398 27.7194 15.5594 28.4303 17.5768 28.4303Z"
                        fill="#2A836B"
                      />
                    </g>
                  </svg>
                </div>
                <div *ngIf="plant.img">
                  <img
                    class="w-11"
                    alt="plant"
                    [src]="'../../../assets/' + plant.img"
                  />
                </div>
              </div>
            </a>
            <div>
              <p class="font-semibold">{{ plant.name }}</p>
              <p>A partir de {{ plant.start_harvest_month }}</p>
            </div>
          </div>
          <!-- Afficher le lien "voir plus" si le nombre de zones est supérieur à 2 -->
          <div class="w-full flex justify-center">
            <a
              *ngIf="plantsNextMonths.length > 2 && !showAllPlantsHarvest"
              (click)="loadMorePlantsHarvest()"
              class="link"
              >Voir tout</a
            >
            <a
              *ngIf="showAllPlantsHarvest"
              (click)="showLessPlantsHarvest()"
              class="link"
              >Voir moins</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div>
    <h4>Astuce du jour</h4>
    <div></div>
  </div> -->

  <div class="section">
    <h4>Mes plantes</h4>
    <div *ngIf="allMyPlants.length < 1" class="flex justify-center w-full">
      <p>
        Vous n'avez pas de plante dans votre potager,
        <a class="text-primary underline" routerLink="/list-plants"
          >ajouter une plante</a
        >
      </p>
    </div>
    <div class="grid grid-cols-3 gap-4">
      <a
        [routerLink]="'/list-plants/' + [plant.id]"
        *ngFor="
          let plant of showAllPlants ? allMyPlants : allMyPlants.slice(0, 6)
        "
        class="bg-base-200 flex flex-col items-center justify-center rounded-md h-24"
      >
        <app-plant-thumbnail
          class="w-28 p-2"
          [plant]="plant"
          [index]="plant.number_of_plant"
        ></app-plant-thumbnail>
      </a>
    </div>
    <!-- Afficher le lien "voir plus" si le nombre de zones est supérieur à 2 -->
    <div class="w-full flex justify-center">
      <a
        *ngIf="allMyPlants.length > 6 && !showAllPlants"
        (click)="loadMorePlants()"
        class="text-primary underline mt-2"
        >Voir tout</a
      >
      <a
        *ngIf="showAllPlants"
        (click)="showLessPlants()"
        class="text-primary underline mt-2"
        >Voir moins</a
      >
    </div>
  </div>

  <div class="section">
    <h4>Mon carnet de bord</h4>
    <div
      class="mb-4 px-4 py-6 rounded-md shadow-md bg-white flex flex-row justify-center items-center gap-2"
    >
      <img
        class="w-20"
        src="../../../assets/carnet.png"
        alt="illustration dame qui lit"
      />
      <div>
        <h5>Besoin d'une vue d'ensemble ?</h5>
        <p>
          Rends-toi sur la page mon carnet de bord, pour suivre tes activités
        </p>
      </div>
      <a
        class="btn btn-square btn-large bg-[#212E50] text-white border-0 btn-neutral rounded-full"
        routerLink="/log-book"
      >
        <mat-icon>chevron_right</mat-icon>
      </a>
    </div>
  </div>
</div>

<dialog
  #dialogRemoveFromGarden
  *ngIf="harvestedPlant"
  class="w-4/5 p-6 shadow-lg rounded-lg bg-[#212E50]"
>
  <div class="flex flex-col justify-between h-full">
    <div class="flex justify-end text-white">
      <button (click)="dialogRemoveFromGarden.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <!-- Modal content -->
    <h4 class="text-white text-lg font-bold text-center mt-2 mb-4">
      Tu as récolté {{ harvestedPlant.name }}
    </h4>
    <p class="mb-4 text-white">Souhaites-tu l'enlever de ton Jardin ?</p>
    <div class="flex flex-row justify-between gap-4">
      <button
        class="btn btn-primary flex-1"
        (click)="harvestSave(harvestedPlant.id, true)"
      >
        Oui
      </button>
      <button
        class="btn btn-white flex-1"
        (click)="harvestSave(harvestedPlant.id, false)"
      >
        Non
      </button>
    </div>
  </div>
</dialog>
